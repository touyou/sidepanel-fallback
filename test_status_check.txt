
> sidepanel-fallback@1.0.0 test
> jest

FAIL test/dependencyInjection.test.js
  SidepanelFallback - Dependency Injection
    DI Container Integration
      ✓ uses custom container when enableDependencyInjection is true (2 ms)
      ✓ uses default implementations when enableDependencyInjection is false
    Custom Implementation Injection
      ✓ uses custom storage implementation
      ✕ uses custom launcher implementation (1 ms)
      ✓ uses custom settings UI implementation
      ✓ uses custom browser detector implementation
    Mixed DI and Custom Implementations
      ✓ prioritizes custom implementations over DI container (1 ms)
    DI Metadata
      ✓ includes DI information in initialization metadata

  ● SidepanelFallback - Dependency Injection › Custom Implementation Injection › uses custom launcher implementation

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "auto", "/test.html"
    Received: "window", "/test.html"

    Number of calls: 1

      103 |       const result = await fallback.openPanel('/test.html');
      104 |
    > 105 |       expect(customLauncher.openPanel).toHaveBeenCalledWith('auto', '/test.html');
          |                                        ^
      106 |       expect(result.method).toBe('custom');
      107 |     });
      108 |

      at Object.toHaveBeenCalledWith (test/dependencyInjection.test.js:105:40)

PASS test/index.test.js
  SidepanelFallback
    init
      ✓ initializes successfully (1 ms)
      ✓ uses default (auto) when mode is unset during initialization
      ✓ can initialize with custom settings
    openPanel
      ✓ opens panel with configured mode (1 ms)
      ✓ selects mode based on browser in auto mode
      ✓ selects window mode for Firefox in auto mode
      ✓ returns error when openPanel is called before init
      ✓ returns error when openPanel is called without arguments (1 ms)
    withSettingsUI
      ✓ creates settings UI and inserts into container
      ✓ saves to storage when settings are changed
      ✓ returns error when withSettingsUI is called before init (1 ms)
      ✓ returns error when container is not specified
    getCurrentSettings
      ✓ can retrieve current settings
      ✓ returns null when called before init (1 ms)

PASS test/settingsUI.test.js
  SettingsUI
    renderSettingsPanel
      ✓ generates settings panel HTML (1 ms)
      ✓ generates UI reflecting current settings value (mode)
      ✓ uses default value (sidepanel) when unset (1 ms)
    bindEvents
      ✓ binds callback function for settings changes
      ✓ calls callback when radio button is changed
    createSettingsPanel
      ✓ creates complete settings panel (rendering + event binding) (1 ms)
      ✓ can create panel without callback function
    createRadioGroup
      ✓ creates radio button group
      ✓ sets checked state correctly

PASS test/modeStorage.test.js
  ModeStorage - localStorage
    ✓ can save browser mode (1 ms)
    ✓ can retrieve saved browser mode
    ✓ returns null for unset browsers
    ✓ throws error for invalid browser name (4 ms)
    ✓ throws error for invalid mode name (1 ms)
    ✓ can use valid mode values

PASS test/panelLauncher.test.js
  PanelLauncher
    openPanel
      ✓ opens sidepanel when chrome.sidePanel.open is available in sidepanel mode (1 ms)
      ✓ uses window.open to open popup in window mode
      ✓ falls back to window when chrome.sidePanel is not available in sidepanel mode (1 ms)
      ✓ falls back to window when chrome.sidePanel.open throws error in sidepanel mode
      ✓ returns error when window.open fails
      ✓ returns error for invalid mode (other than sidepanel or window)
    isExtensionContext
      ✓ returns true when chrome.sidePanel API is available (1 ms)
      ✓ returns false when chrome object does not exist
      ✓ returns false when chrome object exists but sidePanel does not

PASS test/browserInfo.test.js
  getBrowserInfo
    ✓ correctly identifies Chrome user agent
    ✓ can detect Dia browser
    ✓ can detect Firefox
    ✓ can detect Safari
    ✓ can detect Edge
    ✓ returns unknown for unrecognized browsers
    ✓ returns unknown when undefined is passed
    ✓ returns unknown when empty string is passed

Test Suites: 1 failed, 5 passed, 6 total
Tests:       1 failed, 53 passed, 54 total
Snapshots:   0 total
Time:        0.398 s, estimated 1 s
Ran all test suites.
